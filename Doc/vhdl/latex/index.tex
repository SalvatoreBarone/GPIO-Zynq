Periferica A\+X\+I4 Lite che implementa una G\+P\+I\+O pilotabile da processing-\/system. \paragraph*{Registri interni del device}

Il device possiede i registri indicati di seguito. Per oognuno di essi viene indicata la modalita' di accesso (R sola lettura, W sola scrittura, R/\+W lettura scrittura), e l'offset, rispetto all'indirizzo base del device, col quale e' possibile indirizzarli.


\begin{DoxyItemize}
\item M\+O\+D\+E (R/\+W, offset +0x0)\+: consente di impostare i singoli pin del device come ingressi o uscite; solo i G\+P\+I\+O\+\_\+width bit meno significativi del registro hanno significato, agire sui restanti bit non produce nessun effetto; Il valore che i singoli pin possono assumere e'\+:
\begin{DoxyItemize}
\item '1'\+: il pin viene configurato come pin di uscita;
\item 'o'\+: il pin viene configurato come pin di ingresso;
\end{DoxyItemize}
\item W\+R\+I\+T\+E (R/\+W, offset +0x4)\+: consente di imporre un valore ai pin del device, qualora essi siano configurati come uscite; solo i G\+P\+I\+O\+\_\+width bit meno significativi del hanno significato, agire sui restanti bit non produce nessun effetto;
\item R\+E\+A\+D (R, offset +0x8)\+: consente di leggere il valore dei pin del device, sia quelli configurati come ingressi che quelli configurati come uscite (il cui valore coincide con quello settato nel registro W\+R\+I\+T\+E); solo i G\+P\+I\+O\+\_\+width bit meno significativi del registro hanno significato, gli altri vengono letti zero;
\item G\+I\+E\+S (Global Interrupt Enable/\+Status, R/\+W, offset 0x\+C)\+: Consente di abilitare/disabilitare gli interrupt globali della periferica; solo due dei bit sono significativi\+:
\begin{DoxyItemize}
\item I\+E (bit 0)\+: interrupt enable, abilita gli interrupt, puo' essere scritto e letto; se posto ad '1' la periferica potra' generare interrupt quando uno dei pin impostati come ingresso assume valore '1' (ed il corrispondente bit in P\+I\+E e' impostato ad '1'); se posto a '0' il device non generera' mai interruzioni;
\item I\+S (bit 1)\+: interrupt status, settato internamente ad '1' nel caso in cui la periferica abbia generato interrupt; replica del segnale \char`\"{}interrupt\char`\"{} diretto verso il processing-\/system.
\end{DoxyItemize}
\item P\+I\+E (Pin Interrupt Enable, R/\+W, offset 0x10)\+: consente di abilitare/disabilitare gli interrupt per i singoli pin. Con G\+I\+E\+S(0)='1' e M\+O\+D\+E(n)='0' (cioe' se gli interrupt globali sono abilitati e il pin n-\/esimo e' configurato come input), se P\+I\+E(n)='1' allora il device generera' un interrupt verso il processing-\/system quando il pin n-\/esimo assumera' valore '1', mentre, se P\+I\+E(n)='0' non verra' generata una interruzione;
\item I\+R\+Q (Interrupt Request, R, offset 0x14)\+: I\+R\+Q(n)='1' indica che la sorgente di interruzione e' il bit n-\/esimo; la or-\/reduce di tale registro costituisce il segnale \char`\"{}interrupt\char`\"{} diretto verso il processing system;
\item I\+A\+C\+K (Interrupt Ack, W, offset 0x18)\+: imponento I\+A\+C\+K(n)='1' e' possibile segnalare al device che l'interruzione generata dal in n-\/esimo e' stata servita; il bit I\+R\+Q(n) verra' resettato automaticamente.
\end{DoxyItemize}

\paragraph*{Process di scrittura dei registri della periferica}

Il process che implementa la logica di scrittura dei registri e' stato modificato in modo da ottenere il seguente indirizzamento\+: \begin{TabularC}{3}
\hline
\rowcolor{lightgray}{\bf Indirizzo}&{\bf Offset}&{\bf Registro }\\\cline{1-3}
b\char`\"{}00000\char`\"{}&0x00&M\+O\+D\+E \\\cline{1-3}
b\char`\"{}00100\char`\"{}&0x04&W\+R\+I\+T\+E \\\cline{1-3}
b\char`\"{}01000\char`\"{}&0x08&R\+E\+A\+D($\ast$) \\\cline{1-3}
b\char`\"{}01100\char`\"{}&0x0\+C&G\+I\+E\+S($\ast$$\ast$) \\\cline{1-3}
b\char`\"{}10000\char`\"{}&0x10&P\+I\+E \\\cline{1-3}
b\char`\"{}10100\char`\"{}&0x14&I\+R\+Q($\ast$$\ast$$\ast$) \\\cline{1-3}
b\char`\"{}11000\char`\"{}&0x18&I\+A\+C\+K($\ast$$\ast$$\ast$$\ast$) \\\cline{1-3}
\end{TabularC}
($\ast$) Il registro R\+E\+A\+D e' a sola lettura\+: le scritture su questo registro non producono effetti; la scrittura, infatti, avviene su slv\+\_\+reg2, che e' inutilizzato;~\newline
 ($\ast$$\ast$) La scrittura ha effetto solo sul bit zero del registro;~\newline
 ($\ast$$\ast$$\ast$) Il registro I\+R\+Q e' a sola lettura\+: le scritture su questo registro non producono effetti; la scrittura, infatti, avviene su slv\+\_\+reg5, che e' inutilizzato;~\newline
 ($\ast$$\ast$$\ast$$\ast$) La scrittura su I\+A\+C\+K e' fittizzia, nel senso che appena si smette di indirizzare il registro, esso assume valore zero;~\newline


\paragraph*{Process di lettura dei registri della periferica}

Il process che implementa la logica di lettura dei registri e' stato modificato in modo da ottenere il seguente indirizzamento\+: \begin{TabularC}{3}
\hline
\rowcolor{lightgray}{\bf Indirizzo}&{\bf Offset}&{\bf Registro }\\\cline{1-3}
b\char`\"{}00000\char`\"{}&0x00&M\+O\+D\+E \\\cline{1-3}
b\char`\"{}00100\char`\"{}&0x04&W\+R\+I\+T\+E \\\cline{1-3}
b\char`\"{}01000\char`\"{}&0x08&R\+E\+A\+D($\ast$) \\\cline{1-3}
b\char`\"{}01100\char`\"{}&0x0\+C&G\+I\+E\+S($\ast$$\ast$) \\\cline{1-3}
b\char`\"{}10000\char`\"{}&0x10&P\+I\+E \\\cline{1-3}
b\char`\"{}10100\char`\"{}&0x14&I\+R\+Q \\\cline{1-3}
b\char`\"{}11000\char`\"{}&0x18&I\+A\+C\+K($\ast$$\ast$$\ast$) \\\cline{1-3}
\end{TabularC}
($\ast$) Il registro R\+E\+A\+D e' direttamente connesso alla porta G\+P\+I\+O\+\_\+inout~\newline
 ($\ast$$\ast$) Il bit 2 di G\+I\+E\+S e' il flag \char`\"{}interrupt\char`\"{}, che vale '1' nel caso in cui la periferica abbia generato interrupt ancora non gestiti.~\newline
 ($\ast$$\ast$$\ast$) Viene letto sempre zero, dal momento che la scrittura su tale registro e' fittizzia.

\paragraph*{Process di scrittura su I\+R\+Q}

La logica di scrittura su I\+R\+Q e' semplice (non viene scritto come un normale registro, ma pilotato internamente dalla periferica)\+: se uno dei bit di G\+P\+I\+O\+\_\+inout\+\_\+masked e' '1', (la or-\/reduce e' 1) allora il valore del segnale G\+P\+I\+O\+\_\+inout\+\_\+masked viene posto in bitwise-\/or con il valore attuale del registro I\+R\+Q, in modo da non resettare i bit di quest' ultimo che siano stati settati a seguito di una interruzione non ancora servita se uno dei bit di I\+A\+C\+K e' '1' (la or-\/reduce e' '1'), allora il nuovo valore del registro I\+R\+Q viene ottenuto
\begin{DoxyItemize}
\item mascherando I\+A\+C\+K con l'attuale valore di I\+R\+Q, in modo da non effettuare il set di bit resettati
\item ponendo in X\+O\+R la maschera precedente con il valore attuale del registro 
\end{DoxyItemize}