<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Zynq-7000 Driver Pack: UIO-interrupt</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Zynq-7000 Driver Pack
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">C implementation of some Driver for Zynq-7000 Family</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generato da Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Cerca');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Pagina&#160;Principale</span></a></li>
      <li><a href="modules.html"><span>Moduli</span></a></li>
      <li><a href="annotated.html"><span>Strutture&#160;dati</span></a></li>
      <li><a href="files.html"><span>File</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Cerca" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___u_i_o-interrupt.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Tutto</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Strutture dati</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>File</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Funzioni</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variabili</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Tipi enumerati (enum)</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Valori del tipo enumerato</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Definizioni</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Gruppi</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Funzioni</a>  </div>
  <div class="headertitle">
<div class="title">UIO-interrupt<div class="ingroups"><a class="el" href="group__my_g_p_i_o.html">MyGPIO</a> &raquo; <a class="el" href="group___linux-_driver.html">Linux-Driver</a> &raquo; <a class="el" href="group___u_i_o.html">UIO</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Questo e' un programma di esempio per l'interfacciamento con una periferica myGPIO.  
<a href="#details">Continua...</a></p>
<div class="dynheader">
Diagramma di collaborazione per UIO-interrupt:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group___u_i_o-interrupt.png" border="0" alt="" usemap="#group______u__i__o-interrupt"/>
<map name="group______u__i__o-interrupt" id="group______u__i__o-interrupt">
<area shape="rect" id="node2" href="group___u_i_o.html" title="UIO" alt="" coords="5,5,52,32"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Funzioni</h2></td></tr>
<tr class="memitem:ga05909651fa170a63e98e3f8e13451b7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___u_i_o-interrupt.html#ga05909651fa170a63e98e3f8e13451b7b">howto</a> (void)</td></tr>
<tr class="memdesc:ga05909651fa170a63e98e3f8e13451b7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stampa un messaggio che fornisce indicazioni sull'utilizzo del programma.  <a href="#ga05909651fa170a63e98e3f8e13451b7b">Continua...</a><br /></td></tr>
<tr class="separator:ga05909651fa170a63e98e3f8e13451b7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga15f7e5adb83963e5d21ccea3186b5364"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___u_i_o-interrupt.html#ga15f7e5adb83963e5d21ccea3186b5364">parse_args</a> (int argc, char **argv, char **uio_file, uint8_t *op_mode, uint32_t *mode_value, uint8_t *op_write, uint32_t *write_value, uint8_t *op_read)</td></tr>
<tr class="memdesc:ga15f7e5adb83963e5d21ccea3186b5364"><td class="mdescLeft">&#160;</td><td class="mdescRight">Effettua il parsing dei parametri passati al programma.  <a href="#ga15f7e5adb83963e5d21ccea3186b5364">Continua...</a><br /></td></tr>
<tr class="separator:ga15f7e5adb83963e5d21ccea3186b5364"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga78b676750c5d08c316cad35ec3963c53"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___u_i_o-interrupt.html#ga78b676750c5d08c316cad35ec3963c53">gpio_op</a> (void *vrt_gpio_addr, int uio_descriptor, uint8_t op_mode, uint32_t mode_value, uint8_t op_write, uint32_t write_value, uint8_t op_read)</td></tr>
<tr class="memdesc:ga78b676750c5d08c316cad35ec3963c53"><td class="mdescLeft">&#160;</td><td class="mdescRight">Effettua operazioni su un device.  <a href="#ga78b676750c5d08c316cad35ec3963c53">Continua...</a><br /></td></tr>
<tr class="separator:ga78b676750c5d08c316cad35ec3963c53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___u_i_o-interrupt.html#ga3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="separator:ga3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Descrizione dettagliata</h2>
<p>Questo e' un programma di esempio per l'interfacciamento con una periferica myGPIO. </p>
<p>In questo specifico esempio l'interfacciamento avviene da user-space, interagendo attraverso il driver uio. <b>Utilizza gli interrupt per la lettura</b>.</p>
<p>E' possibile accedere ad ognuno dei device attraverso un file diverso. Tale file sara' /dev/uio0 per il primo device, /dev/uio1 per il secondo, /dev/uio2 per il terzo e cosi' via. on for subsequent devices. Tale file puo' essere usato per accedere allo spazio degli indirizzi del device usando mmap().</p>
<p>In questo caso, rispetto al caso NoDriver, accedere al device e' estremamente piu' semplice. Se il device e' compatibile con il driver UIO, e' possibile "aprire" un file in /dev/uioX, effettuare il mapping connettendo l'indirizzo fisico del device allo spazio di indirizzamento del processo, senza la necessita' di conoscere l'indirizzo della periferica col quale di intende comunicare. Ad ogni periferica compatibile con UIO e' associato un file diverso in /dev/uioX attraverso il quale e' possibile raggiungere il device.</p>
<p>Gli interrupt sono gestiti effettuando una lettura bloccante su /dev/uioX. Una read() su /dev/uioX fa in modo che il processo venga sospeso ed inserito nella cosa dei processi in attesa di un evento su quel file. Appena l'interrupt si manifesta, il processo viene posto nella cosa dei processi pronti. La funzione read() consente di ottenere anche il numero totale di interrupt manifestatisi su quella particolare periferica. Quando un device possiede piu' di una sorgente di interrupt interna, ma non possiede maschere IRQ differenti o registri di stato differenti, potrebbe essere impossibile, per un programma in userspace, determinare quale sia la sorgente di interrupt se l'handler implementato nel kernel le disabilita scrivendo nei registri. Per lasciare inalterati i registri della periferica il kernel deve disabilitare completamente le interruzioni, in modo che il programma userspace possa determinare la causa scatenante l'interruzione. Una volta terminate le operazioni, però, il programma userspace non puo' riabilitare le interruzioni, motivo per cui il driver implementa anche una funzione write(). La funzione write(), chiamata su /dev/uioX, consente di riabilitare le interruzioni per quella specifica periferica, scrivendo 1. </p>
<h2 class="groupheader">Documentazione delle funzioni</h2>
<a class="anchor" id="ga78b676750c5d08c316cad35ec3963c53"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gpio_op </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>vrt_gpio_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>uio_descriptor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>op_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>mode_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>op_write</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>write_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>op_read</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Effettua operazioni su un device. </p>
<dl class="params"><dt>Parametri</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">vrt_gpio_addr</td><td>indirizzo di memoria del device gpio </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uio_descriptor</td><td>descrittore del file /dev/uioX usato </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">op_mode</td><td>sara' impostato ad 1 se l'utente intende effettuare scrittuara su mode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mode_value</td><td>conterra' il valore che l'utente intende scrivere nel registro mode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">op_write</td><td>sara' impostato ad 1 se l'utente intende effettuare scrittuara su write </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">write_value</td><td>conterra' il valore che l'utente intende scrivere nel registro write </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">op_read</td><td>sara' impostato ad 1 se l'utente intende effettuare lettura da read </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga05909651fa170a63e98e3f8e13451b7b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void howto </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stampa un messaggio che fornisce indicazioni sull'utilizzo del programma. </p>

</div>
</div>
<a class="anchor" id="ga3c04138a5bfe5d72780bb7e82a18e627"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga15f7e5adb83963e5d21ccea3186b5364"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int parse_args </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>uio_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>op_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>mode_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>op_write</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>write_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>op_read</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Effettua il parsing dei parametri passati al programma. </p>
<dl class="params"><dt>Parametri</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">argc</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">argv</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">uio_file</td><td>file uio da usare </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">op_mode</td><td>sara' impostato ad 1 se l'utente intende effettuare scrittuara su mode </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mode_value</td><td>conterra' il valore che l'utente intende scrivere nel registro mode </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">op_write</td><td>sara' impostato ad 1 se l'utente intende effettuare scrittuara su write </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">write_value</td><td>conterra' il valore che l'utente intende scrivere nel registro write </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">op_read</td><td>sara' impostato ad 1 se l'utente intende effettuare lettura da read</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Valori di ritorno</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>se il parsing ha successo </td></tr>
    <tr><td class="paramname">-1</td><td>se si verifica un errore </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generato Sab 17 Giu 2017 12:35:53 per Zynq-7000 Driver Pack da
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
