\hypertarget{mygpiok_8c}{}\section{Riferimenti per il file Src/\+Examples/mygpiok.c}
\label{mygpiok_8c}\index{Src/\+Examples/mygpiok.\+c@{Src/\+Examples/mygpiok.\+c}}
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$fcntl.\+h$>$}\newline
{\ttfamily \#include \char`\"{}my\+G\+P\+I\+O.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}xil\+\_\+gpio.\+h\char`\"{}}\newline
Grafo delle dipendenze di inclusione per mygpiok.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{mygpiok_8c__incl}
\end{center}
\end{figure}
\subsection*{Strutture dati}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structparam__t}{param\+\_\+t}
\begin{DoxyCompactList}\small\item\em La struttura raccoglie tutti i parametri di esecuzione del programma. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Definizioni}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{mygpiok_8c_a7a63b24ca5489eb3206598e3d90fe19c}{M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET}~\hyperlink{group__bare-metal_ga81a662103d6ed053978c0a9b4c273065}{my\+G\+P\+I\+O\+\_\+\+M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET}
\item 
\#define \hyperlink{mygpiok_8c_a77d96306ed0e813f93c4c3f98b970b86}{W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET}~\hyperlink{group__bare-metal_ga2e45778b6ca9ce6f5768b3f7a4557ce1}{my\+G\+P\+I\+O\+\_\+\+W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET}
\item 
\#define \hyperlink{mygpiok_8c_ad32c3a5b42163e171daccde5b5d5de02}{R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET}~\hyperlink{group__bare-metal_ga584d2dfece76e5762030d918d80592cc}{my\+G\+P\+I\+O\+\_\+\+R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET}
\end{DoxyCompactItemize}
\subsection*{Funzioni}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{mygpiok_8c_a05909651fa170a63e98e3f8e13451b7b}{howto} (void)
\begin{DoxyCompactList}\small\item\em Stampa un messaggio che fornisce indicazioni sull\textquotesingle{}utilizzo del programma. \end{DoxyCompactList}\item 
int \hyperlink{mygpiok_8c_a65d977fb03a14dedd76e1515d6d24ff4}{parse\+\_\+args} (int argc, char $\ast$$\ast$argv, \hyperlink{structparam__t}{param\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em Effettua il parsing dei parametri passati al programma. \end{DoxyCompactList}\item 
void \hyperlink{mygpiok_8c_a63fab82d87963c07f9557a5f5d5d3e86}{gpio\+\_\+op} (\hyperlink{structparam__t}{param\+\_\+t} $\ast$param)
\begin{DoxyCompactList}\small\item\em Effettua operazioni su un device. \end{DoxyCompactList}\item 
int \hyperlink{mygpiok_8c_a3c04138a5bfe5d72780bb7e82a18e627}{main} (int argc, char $\ast$$\ast$argv)
\end{DoxyCompactItemize}


\subsection{Descrizione dettagliata}
\begin{DoxyAuthor}{Autore}
Salvatore Barone \href{mailto:salvator.barone@gmail.com}{\tt salvator.\+barone@gmail.\+com} 
\end{DoxyAuthor}
\begin{DoxyDate}{Data}
16 06 2017
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright 2017 Salvatore Barone \href{mailto:salvator.barone@gmail.com}{\tt salvator.\+barone@gmail.\+com}
\end{DoxyCopyright}
This file is part of Zynq7000\+Driver\+Pack

Zynq7000\+Driver\+Pack is free software; you can redistribute it and/or modify it under the terms of the G\+NU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.

Zynq7000\+Driver\+Pack is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU General Public License for more details.

You should have received a copy of the G\+NU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301, U\+SA. 

\subsection{Documentazione delle definizioni}
\mbox{\Hypertarget{mygpiok_8c_a7a63b24ca5489eb3206598e3d90fe19c}\label{mygpiok_8c_a7a63b24ca5489eb3206598e3d90fe19c}} 
\index{mygpiok.\+c@{mygpiok.\+c}!M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET@{M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET}}
\index{M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET@{M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET}!mygpiok.\+c@{mygpiok.\+c}}
\subsubsection{\texorpdfstring{M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET}{MODE\_OFFSET}}
{\footnotesize\ttfamily \#define M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET~\hyperlink{group__bare-metal_ga81a662103d6ed053978c0a9b4c273065}{my\+G\+P\+I\+O\+\_\+\+M\+O\+D\+E\+\_\+\+O\+F\+F\+S\+ET}}

\begin{Desc}
\item[Esempi\+: ]\par
\hyperlink{mygpiok_8c-example}{mygpiok.\+c}, \hyperlink{no_driver_8c-example}{no\+Driver.\+c}, e \hyperlink{uio_8c-example}{uio.\+c}.\end{Desc}
\mbox{\Hypertarget{mygpiok_8c_ad32c3a5b42163e171daccde5b5d5de02}\label{mygpiok_8c_ad32c3a5b42163e171daccde5b5d5de02}} 
\index{mygpiok.\+c@{mygpiok.\+c}!R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET@{R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET}}
\index{R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET@{R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET}!mygpiok.\+c@{mygpiok.\+c}}
\subsubsection{\texorpdfstring{R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET}{READ\_OFFSET}}
{\footnotesize\ttfamily \#define R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET~\hyperlink{group__bare-metal_ga584d2dfece76e5762030d918d80592cc}{my\+G\+P\+I\+O\+\_\+\+R\+E\+A\+D\+\_\+\+O\+F\+F\+S\+ET}}

\begin{Desc}
\item[Esempi\+: ]\par
\hyperlink{mygpiok_8c-example}{mygpiok.\+c}, \hyperlink{no_driver_8c-example}{no\+Driver.\+c}, e \hyperlink{uio_8c-example}{uio.\+c}.\end{Desc}
\mbox{\Hypertarget{mygpiok_8c_a77d96306ed0e813f93c4c3f98b970b86}\label{mygpiok_8c_a77d96306ed0e813f93c4c3f98b970b86}} 
\index{mygpiok.\+c@{mygpiok.\+c}!W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET@{W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET}}
\index{W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET@{W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET}!mygpiok.\+c@{mygpiok.\+c}}
\subsubsection{\texorpdfstring{W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET}{WRITE\_OFFSET}}
{\footnotesize\ttfamily \#define W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET~\hyperlink{group__bare-metal_ga2e45778b6ca9ce6f5768b3f7a4557ce1}{my\+G\+P\+I\+O\+\_\+\+W\+R\+I\+T\+E\+\_\+\+O\+F\+F\+S\+ET}}

\begin{Desc}
\item[Esempi\+: ]\par
\hyperlink{mygpiok_8c-example}{mygpiok.\+c}, \hyperlink{no_driver_8c-example}{no\+Driver.\+c}, e \hyperlink{uio_8c-example}{uio.\+c}.\end{Desc}


\subsection{Documentazione delle funzioni}
\mbox{\Hypertarget{mygpiok_8c_a63fab82d87963c07f9557a5f5d5d3e86}\label{mygpiok_8c_a63fab82d87963c07f9557a5f5d5d3e86}} 
\index{mygpiok.\+c@{mygpiok.\+c}!gpio\+\_\+op@{gpio\+\_\+op}}
\index{gpio\+\_\+op@{gpio\+\_\+op}!mygpiok.\+c@{mygpiok.\+c}}
\subsubsection{\texorpdfstring{gpio\+\_\+op()}{gpio\_op()}}
{\footnotesize\ttfamily void gpio\+\_\+op (\begin{DoxyParamCaption}\item[{\hyperlink{structparam__t}{param\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



Effettua operazioni su un device. 


\begin{DoxyParams}[1]{Parametri}
\mbox{\tt in}  & {\em param} & puntatore a struttura \hyperlink{structparam__t}{param\+\_\+t}, contiene i vari parametri di esecuzione del programma.\\
\hline
\end{DoxyParams}
La funzione viene invocata dopo che sia stato eseguito il parsing dei parametri passati al programma quando esso viene invocato. è stata scritta per funzionare sia con il G\+P\+IO Xilinx che con il G\+P\+IO custom my\+G\+P\+IO. è possibile utilizzare il primo definendo la macro {\bfseries X\+I\+L\+\_\+\+G\+P\+IO}. Effettua, sul device, le operazioni impostate, in accordo con i parametri passati al programma alla sua invocazione. ~\newline
 Nel caso un cui si usi un driver ad-\/hoc, è possibile usare le funzioni read() e write() per interagire con il device, leggendo il valore dei registri o scrivendolo. Il driver my\+G\+P\+I\+OK mette a disposizione anche la funzione seek() che permette di scegliere quale registro leggere o scrivere. \subparagraph*{Impostazione della modalità di funzionamento}

Per impostare la modalità di funzionamento è necessario scrivere sul registro M\+O\+DE. L\textquotesingle{}offset di tale registro è determinato in base al particolare device che si stà utilizzando. Dopo aver spostato la \char`\"{}testina di scrittura\char`\"{} sul registro M\+O\+DE usando la funzione seek(), viene effettuata la scrittura su di esso usando la funzione write(). è possibile, definendo la macro {\bfseries U\+S\+E\+\_\+\+P\+W\+R\+I\+TE}, usare la funzione pwrite(), che combina le due operazioni.

\subparagraph*{Operazione di scrittura}

Per impostare il valore dei pin del device è necessario scrivere sul registro W\+R\+I\+TE. L\textquotesingle{}offset di tale registro è determinato in base al particolare device che si stà utilizzando. Dopo aver spostato la \char`\"{}testina di scrittura\char`\"{} sul registro W\+R\+I\+TE usando la funzione seek(), viene effettuata la scrittura su di esso usando la funzione write(). è possibile, definendo la macro {\bfseries U\+S\+E\+\_\+\+P\+W\+R\+I\+TE}, usare la funzione pwrite(), che combina le due operazioni.

\subparagraph*{Operazione di lettura con interrupt}

La lettura dei pin del device avviene mediante la chiamata alla funzione read(), dopo aver spostato la \char`\"{}testina di lettura\char`\"{} sul registro R\+E\+AD. L\textquotesingle{}offset di tale registro, come nei due casi precedenti, viene determinato in base al particolare device che si sta usando. è possibile, definendo la macro {\bfseries U\+S\+E\+\_\+\+P\+R\+E\+AD}, usare la funzione pread(), che combina le operazioni di seek() e read(). Il driver my\+G\+P\+I\+OK implementa un meccanismo di lettura bloccante\+: qualora non ci siano dati disponibili, il processo che chiama read() viene sospeso e messo in attesa che i dati siano disponibili. Quando arriva una interruzione dal device, il driver my\+G\+P\+I\+OK lo gestisce e risveglia i processi che erano stati messi precedentemente in attesa. Si legga la documentazione del driver my\+G\+P\+I\+OK per i dettagli.\begin{Desc}
\item[Esempi\+: ]\par
\hyperlink{mygpiok_8c-example}{mygpiok.\+c}.\end{Desc}
\mbox{\Hypertarget{mygpiok_8c_a05909651fa170a63e98e3f8e13451b7b}\label{mygpiok_8c_a05909651fa170a63e98e3f8e13451b7b}} 
\index{mygpiok.\+c@{mygpiok.\+c}!howto@{howto}}
\index{howto@{howto}!mygpiok.\+c@{mygpiok.\+c}}
\subsubsection{\texorpdfstring{howto()}{howto()}}
{\footnotesize\ttfamily void howto (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Stampa un messaggio che fornisce indicazioni sull\textquotesingle{}utilizzo del programma. 

\begin{Desc}
\item[Esempi\+: ]\par
\hyperlink{mygpiok_8c-example}{mygpiok.\+c}.\end{Desc}
\mbox{\Hypertarget{mygpiok_8c_a3c04138a5bfe5d72780bb7e82a18e627}\label{mygpiok_8c_a3c04138a5bfe5d72780bb7e82a18e627}} 
\index{mygpiok.\+c@{mygpiok.\+c}!main@{main}}
\index{main@{main}!mygpiok.\+c@{mygpiok.\+c}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$$\ast$}]{argv }\end{DoxyParamCaption})}

\begin{Desc}
\item[Esempi\+: ]\par
\hyperlink{mygpiok_8c-example}{mygpiok.\+c}.\end{Desc}
\mbox{\Hypertarget{mygpiok_8c_a65d977fb03a14dedd76e1515d6d24ff4}\label{mygpiok_8c_a65d977fb03a14dedd76e1515d6d24ff4}} 
\index{mygpiok.\+c@{mygpiok.\+c}!parse\+\_\+args@{parse\+\_\+args}}
\index{parse\+\_\+args@{parse\+\_\+args}!mygpiok.\+c@{mygpiok.\+c}}
\subsubsection{\texorpdfstring{parse\+\_\+args()}{parse\_args()}}
{\footnotesize\ttfamily int parse\+\_\+args (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$$\ast$}]{argv,  }\item[{\hyperlink{structparam__t}{param\+\_\+t} $\ast$}]{param }\end{DoxyParamCaption})}



Effettua il parsing dei parametri passati al programma. 


\begin{DoxyParams}[1]{Parametri}
\mbox{\tt in}  & {\em argc} & \\
\hline
\mbox{\tt in}  & {\em argv} & \\
\hline
\mbox{\tt out}  & {\em param} & puntatore a struttura \hyperlink{structparam__t}{param\+\_\+t}, conterrà i vari parametri di esecuzione del programma.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Valori di ritorno}
{\em 0} & se il parsing ha successo \\
\hline
{\em -\/1} & se si verifica un errore \\
\hline
\end{DoxyRetVals}
\subparagraph*{Parsing dei parametri del programma.}

Il parsing viene effettuato usando la funzione getopt(). 
\begin{DoxyCode}
\textcolor{preprocessor}{#include <unistd.h>}
\textcolor{keywordtype}{int} getopt(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keyword}{const} \textcolor{keywordtype}{char} *optstring);
\end{DoxyCode}
 Essa prende in input i parametri argc ed argv passati alla funzione \hyperlink{mygpiok_8c_a3c04138a5bfe5d72780bb7e82a18e627}{main()} quando il programma viene invocato. Quando una delle stringhe che compongono argv comincia con il carattere \textquotesingle{}-\/\textquotesingle{}, getopt() la considera una opzione. Il carattere immediatamente successivo il \textquotesingle{}-\/\textquotesingle{} identifica la particolare opzione. La funzione può essere chiamata ripetutamente, fino a quando non restituisce -\/1, ad indicare che sono stati analizzati tutti i parametri passati al programma. Quando getopt() trova un\textquotesingle{}opzione, restituisce quel carattere ed aggiorna la variabile globale optid, che punta al prossimo parametro contenuto in argv. La stringa optstring indica quali sono le opzioni considerate. Se una opzione è seguita da \textquotesingle{}\+:\textquotesingle{} vuol dire che essa è seguita da un argomento. Tale argomento può essere ottenuto mediante la variabile globale optarg.

\subparagraph*{Parametri riconosciuti}

La funzione riconosce i parametri\+:
\begin{DoxyItemize}
\item \textquotesingle{}d\textquotesingle{} \+: seguito dal percorso del device /dev/my\+G\+P\+I\+OK col quale interagire
\item \textquotesingle{}w\textquotesingle{} \+: operazione di scrittura, seguito dal valore che si intende scrivere, in esadecimale; la scrittura verrà effettuata sul registro W\+R\+I\+TE;
\item \textquotesingle{}m\textquotesingle{} \+: impostazione modalità, seguito dalla modalità col quale impostare il device; la scrittura verrà effettuata sul registro M\+O\+DE;
\item \textquotesingle{}r\textquotesingle{} \+: operazione di lettura, primo di argomento; la lettura viene effettuata dal registro R\+E\+AD ed è non bloccante, nel senso che viene semplicemente letto il contenuto del registro.
\end{DoxyItemize}

Se non viene specificato il device my\+G\+P\+I\+OK col quale interagire è impossibile continuare. Per questo motivo, in questo caso, la funzione restituisce -\/1, per cui il programma viene terminato.

\subparagraph*{Accesso ad un device tramite il driver my\+G\+P\+I\+OK}

Ad ogni periferica compatibile con il driver my\+G\+P\+I\+OK è associato un file diverso in /dev/ attraverso il quale è possibile interagire con il device. Rispetto al driver U\+IO, non è necessario effettuare nessuna operazione di mapping, in quanto il driver my\+G\+P\+I\+OK tradurrà le sistem-\/call che normalmente verrevvero usate su un file, in operazioni specifiche per il device. L\textquotesingle{}accesso al device viene ottenuto mediante la system-\/call open()\+: 
\begin{DoxyCode}
\textcolor{preprocessor}{#include <sys/stat.h>}
\textcolor{preprocessor}{#include <fcntl.h>}
\textcolor{keywordtype}{int} open(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *path, \textcolor{keywordtype}{int} oflag, ...  );
\end{DoxyCode}
 la quale restituisce il descrittore del file /dev/my\+G\+P\+I\+O\+Kx, usato nel seguito per effettuare le operazioni di I/O. I valori del parametro oflag specificano il modo in cui il file viene aperto. In questo caso viene usato O\+\_\+\+R\+D\+WR, il quale garantisce accesso in lettura ed in scrittura. Altri valori sono O\+\_\+\+R\+D\+O\+N\+LY, il quale garantisce accesso in sola lettura, ed O\+\_\+\+W\+R\+O\+N\+LY, che, invece, garantisce accesso in sola scrittura. Se l\textquotesingle{}apertura del file non riesce è impossibile continuare. Per questo motivo, in questo caso, la funzione restituisce -\/1, per cui il programma viene terminato.\begin{Desc}
\item[Esempi\+: ]\par
\hyperlink{mygpiok_8c-example}{mygpiok.\+c}.\end{Desc}
